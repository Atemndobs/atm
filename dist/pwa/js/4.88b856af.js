(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0595":function(t,o,a){},"23ff":function(t,o,a){"use strict";a("0595")},a00b:function(t,o,a){"use strict";a.r(o);var e=function(){var t=this,o=t.$createElement,a=t._self._c||o;return a("q-page",{staticClass:"constrain-more q-pa-md"},[a("div",{staticClass:"camera-frame q-pa-md"},[a("video",{directives:[{name:"show",rawName:"v-show",value:!t.imageCaptured,expression:"!imageCaptured"}],ref:"video",staticClass:"full-width",attrs:{autoplay:""}}),a("canvas",{directives:[{name:"show",rawName:"v-show",value:t.imageCaptured,expression:"imageCaptured"}],ref:"canvas",staticClass:"full-width",attrs:{height:"240"}})]),a("div",{staticClass:"text-center q-pa-md"},[t.hasCameraSupport&&t.showCamera?a("q-btn",{attrs:{color:"grey-10",icon:"eva-camera",round:"",size:"lg",disable:t.imageCaptured},on:{click:t.captureImage}}):t.showCamera?a("q-file",{attrs:{outlined:"",label:"Chose an image",accept:"image/*"},on:{input:t.captureImageFallback},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"eva-attach-outline"}})]},proxy:!0}]),model:{value:t.imageUpload,callback:function(o){t.imageUpload=o},expression:"imageUpload"}}):a("q-btn",{attrs:{color:"grey-10",icon:"cancel",round:"",size:"lg"},on:{click:t.cancelPhoto}})],1),a("div",{staticClass:"row justify-center q-ma-md"},[a("q-input",{staticClass:"col col-sm-6",attrs:{label:"Caption*",dense:""},model:{value:t.post.caption,callback:function(o){t.$set(t.post,"caption",o)},expression:"post.caption"}})],1),a("div",{staticClass:"row justify-center q-ma-md"},[a("q-input",{staticClass:"col col-sm-6",attrs:{label:"Location",loading:t.locationLoading,dense:""},scopedSlots:t._u([{key:"append",fn:function(){return[!t.locationLoading&&t.locationSupported?a("q-btn",{attrs:{dense:"",flat:"",icon:"eva-navigation-2-outline",round:""},on:{click:t.getLocation}}):t._e()]},proxy:!0}]),model:{value:t.post.location,callback:function(o){t.$set(t.post,"location",o)},expression:"post.location"}})],1),a("div",{staticClass:"row justify-center q-mt-lg"},[a("q-btn",{attrs:{disable:!t.post.caption||!t.post.photo,color:"primary",label:"Post Image",rounded:"",unelevated:""},on:{click:function(o){return t.sendPost()}}})],1)])},i=[],n=(a("99af"),a("4160"),a("e260"),a("c19f"),a("ace4"),a("d3b7"),a("ac1f"),a("1276"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("159b"),a("b178"));a("3022");a("121f");var s={name:"Page",data:function(){return{post:{id:Object(n["e"])(),caption:"Around the world",location:"Somewhere on Earth",photo:null,date:Date.now(),imageId:"",imageUrl:"",userId:""},imageCaptured:!1,imageUpload:[],hasCameraSupport:!0,locationLoading:!1,showCamera:!0}},computed:{locationSupported:function(){return"geolocation"in navigator},backgroundSyncSupported:function(){return"serviceWorker"in navigator&&"SyncManager"in window}},methods:{initCamera:function(){var t=this;navigator.mediaDevices.getUserMedia({video:!0}).then((function(o){t.$refs.video.srcObject=o})).catch((function(o){t.hasCameraSupport=!1}))},captureImage:function(){var t=this.$refs.video,o=this.$refs.canvas;o.width=t.getBoundingClientRect().width,o.height=t.getBoundingClientRect().height;var a=o.getContext("2d");a.drawImage(t,0,0,o.width,o.height),this.imageCaptured=!0,this.showCamera=!1,this.post.photo=this.dataURItoBlob(o.toDataURL()),this.disableCamera()},cancelPhoto:function(){location.reload(),this.showCamera=!0},captureImageFallback:function(t){this.post.photo=t;var o=this.$refs.canvas,a=o.getContext("2d"),e=new FileReader;e.onload=function(t){var e=new Image;e.onload=function(){o.width=e.width,o.height=e.height,a.drawImage(e,0,0)},e.src=t.target.result},e.readAsDataURL(t),this.imageCaptured=!0},disableCamera:function(){this.$refs.video.srcObject.getVideoTracks().forEach((function(t){t.stop()}))},dataURItoBlob:function(t){for(var o=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(o.length),i=new Uint8Array(e),n=0;n<o.length;n++)i[n]=o.charCodeAt(n);var s=new Blob([e],{type:a});return s},getLocation:function(){var t=this;this.locationLoading=!0,navigator.geolocation.getCurrentPosition((function(o){t.getCityAndCountry(o)}),(function(o){t.locationError()}),{timeout:7e3})},getCityAndCountry:function(t){var o=this,a="https://geocode.xyz/".concat(t.coords.latitude,",").concat(t.coords.longitude,"?json=1");this.$axios.get(a).then((function(t){o.locationSuccesss(t)})).catch((function(t){o.locationError()}))},locationSuccesss:function(t){this.post.location=t.data.city,t.data.country&&(this.post.location+=", ".concat(t.data.country)),this.locationLoading=!1},locationError:function(){this.$q.dialog({title:"Error",message:"Could not find your Location"}),this.locationLoading=!1},addPost:function(){var t=this;this.$q.loading.show();var o=new FormData;o.append("id",this.post.id),o.append("caption",this.post.caption),o.append("location",this.post.location),o.append("file",this.post.photo,this.post.id+".png"),this.$axios.post("".concat("http://localhost:8000/api","/createPost"),o).then((function(o){t.$router.push("/"),t.$q.notify({message:"Post Created",color:"positive",avatar:"https://firebasestorage.googleapis.com/v0/b/deja-vue-e67a1.appspot.com/o/avat_atem.png?alt=media&token=5827b153-5462-4301-81be-ade0777202d4",actions:[{label:"Dismis",color:"white"}]}),t.$q.loading.hide()})).catch((function(o){!navigator.onLine&&t.backgroundSyncSupported?(t.$q.notify("Post Created offline"),t.$router.push("/")):t.$q.dialog({title:"Error",message:"Sorry Could not create post"}),t.$q.loading.hide()}))},sendPost:function(){this.$q.loading.show(),this.createImage()},createImage:function(){var t=this,o=new FormData;o.append("image",this.post.photo,this.post.id+".png"),this.$axios.post("".concat("http://localhost:8000/api","/designs"),o).then((function(o){t.user_id=o.data.user_id,t.imageId=o.data.id;var a=new FormData;a.append("caption",t.post.caption),a.append("location",t.post.location),a.append("image",t.post.photo,t.post.id+".png"),t.submitPost(a)})).catch((function(o){!navigator.onLine&&t.backgroundSyncSupported?(t.$q.loading.hide(),t.$q.notify("Post Created offline"),t.$router.push("/")):(t.$q.loading.hide(),t.$q.dialog({title:"Error",message:"Sorry Could not create post"}))}))},getImage:function(t){var o=this;this.$axios.get("".concat("http://localhost:8000/api","/image/").concat(t)).then((function(t){var a=t.data.image;o.post.caption,o.post.location})).catch((function(t){!navigator.onLine&&o.backgroundSyncSupported?(o.$q.loading.hide(),o.$q.notify("Post Created offline"),o.$router.push("/")):(o.$q.loading.hide(),o.$q.dialog({title:"Error",message:"Sorry Could not create post"}))}))},submitPost:function(t){var o=this;this.$axios.post("".concat("http://localhost:8000/api","/posts/").concat(this.user_id),t).then((function(t){console.log("SUBMITTED POST :: => "),console.log(t),o.$router.push("/"),o.$q.notify({message:"Post Created",color:"positive",avatar:"https://firebasestorage.googleapis.com/v0/b/deja-vue-e67a1.appspot.com/o/avat_atem.png?alt=media&token=5827b153-5462-4301-81be-ade0777202d4",actions:[{label:"Dismis",color:"white"}]}),o.$q.loading.hide()})).catch((function(t){!navigator.onLine&&o.backgroundSyncSupported?(o.$q.notify("Post Created offline"),o.$router.push("/")):o.$q.dialog({title:"Error",message:"Sorry Could not create post"}),o.$q.loading.hide()}))}},mounted:function(){this.initCamera()},beforeDestroy:function(){this.hasCameraSupport&&this.disableCamera()}},c=s,r=(a("23ff"),a("2877")),d=Object(r["a"])(c,e,i,!1,null,null,null);o["default"]=d.exports}}]);